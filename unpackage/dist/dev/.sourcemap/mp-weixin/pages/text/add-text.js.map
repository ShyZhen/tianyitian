{"version":3,"sources":["uni-app:///main.js","webpack:///E:/githubShyzhen/tianyitian/pages/text/add-text.vue?071b","webpack:///E:/githubShyzhen/tianyitian/pages/text/add-text.vue?cc89","webpack:///E:/githubShyzhen/tianyitian/pages/text/add-text.vue?e1e6","webpack:///E:/githubShyzhen/tianyitian/pages/text/add-text.vue?7e8c","uni-app:///pages/text/add-text.vue","webpack:///E:/githubShyzhen/tianyitian/pages/text/add-text.vue?0482","webpack:///E:/githubShyzhen/tianyitian/pages/text/add-text.vue?3760"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,gG;AACAA,UAAU,CAACC,gBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiI;AACjI;AAC4D;AACL;AACsC;;;AAG7F;AAC2K;AAC3K,gBAAgB,oLAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,+FAAM;AACR,EAAE,wGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAgoB,CAAgB,qpBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACsCppB,gD;;;;;;;;AAQA;AACA;AACA;AACA,0B;;AAEA;AACA;AACA,wBADA;AAEA,kBAFA;AAGA,oBAHA,EADA;;AAMA,MANA,kBAMA;AACA;AACA,+BADA;AAEA,qBAFA;AAGA,oBAHA,EAGA;AACA,qBAJA,EAIA;AACA,4BALA;AAMA,8BANA;AAOA,qCAPA;AAQA,WARA;AASA,sBATA;AAUA,mBAVA;AAWA,sDAXA;AAYA,2BAZA;AAaA,uBAbA;AAcA,UAdA;AAeA,UAfA;AAgBA,UAhBA;AAiBA,oBAjBA;AAkBA,kBAlBA;AAmBA,iCAnBA;AAoBA,gCApBA;AAqBA,uCArBA;AAsBA,sCAtBA;AAuBA,yBAvBA;AAwBA,wBAxBA;AAyBA,qBAzBA;AA0BA,kBA1BA;;AA4BA,GAnCA;AAoCA;AACA;AACA,wBADA,GADA;;AAIA;AACA;AACA,KANA;AAOA;AACA;AACA,KATA;AAUA;AACA;AACA,KAZA,GApCA;;AAkDA,QAlDA,kBAkDA,MAlDA,EAkDA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,GAhGA;AAiGA,SAjGA,qBAiGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,EAEA,oBAFA;AAGA;AACA,GAjHA;AAkHA,QAlHA,oBAkHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAJA,MAIA;AACA;AACA;AACA;AACA,YADA,CACA;AACA;AACA,SAHA;AAIA,aAJA,CAIA;AACA;AACA,SANA;AAOA;AACA;AACA;AACA,GAvIA;AAwIA,QAxIA,oBAwIA,EAxIA;AAyIA,mBAzIA,+BAyIA;AACA;AACA,4CADA;AAEA,2BAFA;AAGA,oDAHA;AAIA,gCAJA;AAKA;AACA;AACA,OAPA;;AASA,GAnJA;AAoJA;AACA,gDADA;AAEA,eAFA,uBAEA,CAFA,EAEA;AACA;AACA;AACA;AACA,KANA;AAOA;AACA;AACA;AACA,KAVA;AAWA,SAXA,iBAWA,cAXA,EAWA,iBAXA,EAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAHA;;AAKA,KA3BA;AA4BA,iBA5BA,yBA4BA,aA5BA,EA4BA;AACA;AACA;AACA,KA/BA;AAgCA,gBAhCA,0BAgCA;AACA;AACA,kBADA;AAEA,KAnCA;AAoCA,iBApCA,yBAoCA,iBApCA,EAoCA;AACA;AACA,UADA;AAEA;AACA,KAxCA;AAyCA;;;AAGA,mBA5CA,6BA4CA;AACA;AACA,2BADA;AAEA,mBAFA;AAGA,kBAHA;AAIA,oBAJA;AAKA,sBALA;AAMA,kBANA;AAOA,sBAPA;;AASA;AACA;AACA;AACA;AACA,SAHA;;AAKA,KA5DA;AA6DA;;;;;;;;AAQA,0BArEA,kCAqEA,MArEA,EAqEA,MArEA,EAqEA,OArEA,EAqEA,OArEA,EAqEA,CArEA,EAqEA,YArEA,EAqEA;AACA;AACA;AACA;AACA;AACA,8CALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAlFA;AAmFA,aAnFA,qBAmFA,IAnFA,EAmFA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OANA,MAMA;AACA;AACA;AACA;AACA;AACA;AACA,KA7GA;AA8GA,6BA9GA,qCA8GA,QA9GA,EA8GA;AACA;AACA,uBADA;;AAGA;AACA;AACA,qBADA;AAEA;AACA;AACA;AACA;AACA;AACA,SAPA;AAQA;AACA;AACA;AACA;AACA,2BADA;AAEA,oCAFA;AAGA,mBAHA,mBAGA,GAHA,EAGA;AACA;AACA;AACA,eAFA,MAEA;AACA;AACA;AACA,aATA;;AAWA,SAtBA;;AAwBA,KA3IA;AA4IA;;;AAGA,eA/IA,uBA+IA,CA/IA,EA+IA;AACA;AACA,wBADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA,wEAHA,CAGA;AACA;AACA;AACA;AACA,WAPA,MAOA;AACA;AACA,+BADA;AAEA,4CAFA;AAGA,+BAHA;;AAKA;AACA,SAlBA;;AAoBA,KApKA;AAqKA;;;AAGA,eAxKA,yBAwKA;AACA;AACA;AACA,gBADA,EACA;AACA,gCAFA,EAEA;AACA,uCAHA;AAIA;AACA;AACA;AACA;AACA;AACA,SATA;;AAWA,KArLA;AAsLA,6BAtLA,qCAsLA,aAtLA,EAsLA;AACA;AACA;AACA;AACA,0BADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAJA,MAIA;AACA;AACA,mEADA;;AAGA;AACA,SAjBA;;AAmBA,KA5MA;AA6MA,qBA7MA,+BA6MA;AACA;AACA;AACA,sCADA,IACA,kCADA,EACA;AACA;AACA,2BADA;AAEA,gCAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBADA,CACA;AACA;AACA,mBAHA;AAIA,uBAJA,CAIA;AACA;AACA;AACA,mBAPA;AAQA,iBAVA;AAWA;AACA,aAhBA,MAgBA;AACA;AACA;AACA;AACA;AACA,WAzBA;;AA2BA,OA7BA,MA6BA;AACA;AACA;AACA,KA/OA;AAgPA;;;AAGA,YAnPA,sBAmPA;AACA;AACA;AACA;AACA,sBADA;AAEA,kBAFA;;AAIA;AACA,YADA;AAEA,YAFA;AAGA,mCAHA;AAIA,qCAJA;AAKA,qCALA;AAMA,uCANA;AAOA,oCAPA;AAQA;AACA;AACA;AACA,sCADA;AAEA;AACA;AACA,+BADA;;AAGA;AACA;AACA;AACA,iBAHA;;AAKA;AACA;AACA;AACA,8CADA,EACA;AACA;AACA,oBADA,CACA;AACA;AACA,iBAHA;AAIA,qBAJA,CAIA;AACA;AACA;AACA,mBAFA,EAEA,KAFA,CAEA;AACA;AACA;AACA,mBALA;AAMA;AACA,iBAZA;AAaA;AACA;AACA,aA9BA;AA+BA,gBA/BA,gBA+BA,GA/BA,EA+BA;AACA;AACA;AACA;AACA,oCADA;AAEA,yBAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA,+BADA,mBACA,GADA,EACA;AACA;AACA,yBAHA;AAIA,4BAJA,gBAIA,GAJA,EAIA;AACA;AACA,yBANA;;AAQA;AACA,mBAbA;;AAeA;AACA,aAlDA;;AAoDA,SA9DA;AA+DA,YA/DA,gBA+DA,GA/DA,EA+DA;AACA;AACA,SAjEA;AAkEA,UAlEA;AAmEA,KA7TA;AA8TA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BADA;AAEA,kBAFA;AAGA;AACA;AACA;AACA;AACA,4CADA,EACA;AACA;AACA;AACA;AACA,+BADA;;AAGA;AACA;AACA,oCADA;AAEA;AACA,oCADA,EAFA;;AAKA,uBALA,mBAKA,IALA,EAKA;AACA;AACA;AACA;AACA,yCADA;AAEA,2CAFA;AAGA,uCAHA;AAIA,wCAJA;;AAMA;AACA,mBARA,MAQA;AACA;AACA;AACA;AACA;AACA,iBApBA;AAqBA,oBArBA,gBAqBA,CArBA,EAqBA;AACA;AACA;AACA,gCADA;AAEA,0CAFA;AAGA,qCAHA;AAIA,qCAJA;;AAMA,iBA7BA;AA8BA,wBA9BA,sBA8BA;AACA;AACA,iBAhCA;;AAkCA,aA1CA;;AA4CA,SAlDA;;AAoDA,KAxXA,GApJA,E;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAkrC,CAAgB,mpCAAG,EAAC,C;;;;;;;;;;;ACAtsC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/text/add-text.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/text/add-text.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./add-text.vue?vue&type=template&id=0a283052&scoped=true&\"\nvar renderjs\nimport script from \"./add-text.vue?vue&type=script&lang=js&\"\nexport * from \"./add-text.vue?vue&type=script&lang=js&\"\nimport style0 from \"./add-text.vue?vue&type=style&index=0&id=0a283052&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0a283052\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/text/add-text.vue\"\nexport default component.exports","export * from \"-!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add-text.vue?vue&type=template&id=0a283052&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add-text.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add-text.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"container\" :style=\"{height:windowHeight+'px'}\">\r\n    <view id=\"avatar-section\">\r\n      <canvas canvas-id=\"cans-id-happines\" style=\"width:270px; height:270px;\" class=\"isCan\"></canvas>\r\n    </view>\r\n\r\n    <view class=\"grid justify-around action-wrapper\">\r\n      <view class=\"grid col-1\">\r\n        <button id=\"btn-my-avatar\" class=\"cu-btn round action-btn bg-gradual-blue shadow \" @tap=\"getUserInfo\">我的头像</button>\r\n      </view>\r\n      <view class=\"grid col-2\">\r\n        <button id=\"btn-save\" class=\"cu-btn round action-btn bg-gradual-blue shadow\" @click=\"checkAdBeforeSave\">\r\n          <text class=\"cuIcon-down\">\r\n          </text>保存</button>\r\n      </view>\r\n      <view class=\"grid col-3\">\r\n        <button id=\"btn-choose-img\" class=\"cu-btn round action-btn bg-gradual-blue shadow\" @click=\"chooseImage\">选择图片</button>\r\n      </view>\r\n    </view>\r\n\r\n    <view>\r\n      <view class=\"uni-form-item uni-column\">\r\n        <view class=\"title uni-inline-item\" style=\"margin: 10px;color: #FFF\">输入一个字:\r\n          <input class=\"uni-inline-item\" style=\"margin: 10px\" confirm-type=\"done\" @blur=\"onKeyInput\" @confirm=\"onKeyInput\" maxlength=\"1\" placeholder=\"白,富,美,萌,忙,帅,萌,矮,丑,穷\" />\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <view>\r\n      <view class=\"grid col-5 padding-sm\">\r\n        <view class=\"margin-tb-sm text-center\" v-for=\"(item,index) in ColorList\" :key=\"index\">\r\n          <button @click=\"changeColor\" :data-color=\"item.color\" class=\"cu-btn round\" :class=\"['bg-' + item.name , shadow?'shadow':'']\">{{item.title}}</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n<script>\r\nimport {\r\n  mapState,\r\n  mapMutations\r\n} from \"vuex\";\r\nimport tuiFooter from \"@/components/tui/footer\";\r\nimport tuiFab from \"@/components/tui/tui-fab\";\r\nimport addTips from \"@/components/add-tips\";\r\n\r\n// 在页面中定义激励视频广告\r\nlet videoAd = null;\r\n// 在页面中定义插屏广告\r\nlet interstitialAd = null\r\n\r\nexport default {\r\n  components: {\r\n    tuiFooter,\r\n    tuiFab,\r\n    addTips\r\n  },\r\n  data() {\r\n    return {\r\n      ColorList: this.ColorList,\r\n      windowHeight: 0,\r\n      cansWidth: 270, // 宽度 px\r\n      cansHeight: 270, // 高度 px\r\n      cansBgColor: \"#FFD314\",\r\n      cornerBgColor: '#C12928',\r\n      cornerBgBoarderColor: '#FFFFFF',\r\n      r: 40,\r\n      boarderWidth: 15,\r\n      wishText: '萌',\r\n      avatarPath: '/static/image/mask/avatar_mask.jpg',\r\n      happinessPathList: [],\r\n      happinessIndex: 0,\r\n      x: 0,\r\n      y: 0,\r\n      z: 0,\r\n      savedCounts: 0,\r\n      freeCount: 1,\r\n      enableRewardedVideoAd: true,\r\n      enableInterstitialAd: true,\r\n      rewardedVideoAdAlreadyShow: false,\r\n      interstitialAdAlreadyShow: false,\r\n      ownImageUsed: false,\r\n      statusBarHeight: 0,\r\n      SHOW_TIP: false,\r\n      duration: 20\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      userInfo: 'userInfo'\r\n    }),\r\n    happinessPath: function() {\r\n      return this.happinessPathList[this.happinessIndex];\r\n    },\r\n    cornerX: function() {\r\n      return Math.ceil(this.cansWidth * 0.7);\r\n    },\r\n    cornerY: function() {\r\n      return Math.ceil(this.cansHeight * 0.7);\r\n    }\r\n  },\r\n  onLoad(option) {\r\n    this.ctx = uni.createCanvasContext('cans-id-happines', this);\r\n    this.paint();\r\n\r\n    let that = this;\r\n\r\n    // // 在页面onLoad回调事件中创建插屏广告实例\r\n    // if (wx.createInterstitialAd) {\r\n    // \tinterstitialAd = wx.createInterstitialAd({\r\n    // \t\tadUnitId: 'adunit-0eed22f1c6e7d39e'\r\n    // \t})\r\n    // \tinterstitialAd.onLoad(() => {})\r\n    // \tinterstitialAd.onError((err) => {})\r\n    // \tinterstitialAd.onClose(() => {})\r\n    // }\r\n\r\n    // // 在页面onLoad回调事件中创建激励视频广告实例\r\n    // if (wx.createRewardedVideoAd) {\r\n    // \tvideoAd = wx.createRewardedVideoAd({\r\n    // \t\tadUnitId: 'adunit-e9dfe89f3616833e'\r\n    // \t})\r\n    // \tvideoAd.onLoad(() => {\r\n    // \t\tthat.rewardedVideoAdLoaded = true;\r\n    // \t})\r\n    // \tvideoAd.onError((err) => {\r\n    // \t\t// 广告组件出现错误，直接允许用户保存，不做其他复杂处理\r\n    // \t\tconsole.log('videoAd.onError', err);\r\n    // \t\tthat.rewardedVideoAdLoaded = false;\r\n    // \t})\r\n    // \tvideoAd.onClose((res) => {\r\n    // \t\tif (res && res.isEnded || res === undefined) {\r\n    // \t\t\t// 正常播放结束，下发奖励\r\n    // \t\t\tconsole.log('正常播放结束，下发奖励');\r\n    // \t\t\tthat.rewardedVideoAdAlreadyShow = true; // 本次使用不再展现激励广告\r\n    // \t\t\tthat.saveCans();\r\n    // \t\t} else {\r\n    // \t\t\t// 播放中途退出，进行提示\r\n    // \t\t\tconsole.log('播放中途退出，重新提示');\r\n    // \t\t\tconsole.log('rewardedVideoAdAlreadyShow', that.rewardedVideoAdAlreadyShow);\r\n    // \t\t\tthat.rewardedVideoAdAlreadyShow = false;\r\n    // \t\t\tthat.checkAdBeforeSave();\r\n    // \t\t}\r\n\r\n    // \t})\r\n    // }\r\n\r\n  },\r\n  onReady() {\r\n    console.log(\"onReady\");\r\n    // 判断是否已经显示过\r\n    let cache = uni.getStorageSync(getApp().globalData.STORAGE_KEY);\r\n    console.log('cache', cache);\r\n    if (!cache) {\r\n      this.statusBarHeight = getApp().globalData.statusBarHeight;\r\n      // 没显示过，则进行展示\r\n      this.SHOW_TIP = true;\r\n      console.log('SHOW_TIP', this.SHOW_TIP);\r\n      // 关闭时间\r\n      let that = this;\r\n      setTimeout(() => {\r\n        that.SHOW_TIP = false;\r\n      }, that.duration * 1000);\r\n    }\r\n  },\r\n  onShow() {\r\n    console.log(\"onshow\");\r\n    // let defaultAvatarIndex = Math.round(Math.random());\r\n    // console.log(defaultAvatarIndex);\r\n    if (getApp().globalData.rapaintAfterCrop) {\r\n      getApp().globalData.rapaintAfterCrop = false;\r\n      this.avatarPath = getApp().globalData.cropImageFilePath;;\r\n      this.paint();\r\n    } else {\r\n      //从剪裁页面跳转回来时不用展示，其他情况下，页面打开时展示插屏广告\r\n      if (interstitialAd && this.enableInterstitialAd && !this.interstitialAdAlreadyShow) {\r\n        interstitialAd.show()\r\n            .then(() => {\r\n              this.interstitialAdAlreadyShow = true;\r\n            })\r\n            .catch((err) => {\r\n              console.error(err)\r\n            })\r\n      }\r\n    }\r\n    this.windowHeight = getApp().globalData.windowHeight;\r\n  },\r\n  onHide() {},\r\n  onShareAppMessage() {\r\n    return {\r\n      title: '我换上了口罩头像，防止疫情蔓延，30款口罩、护目镜任你选！',\r\n      desc: '防传染、戴口罩，从我做起！',\r\n      imageUrl: '/static/image/mask/avatar_mask.png',\r\n      path: '/pages/index/index',\r\n      success: function(res) {\r\n        console.log(res);\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapMutations([\"saveLoginUserInfo\"]),\r\n    changeColor(e) {\r\n      console.log(e);\r\n      this.cornerBgColor = e.currentTarget.dataset.color;\r\n      this.paint();\r\n    },\r\n    onKeyInput: function(event) {\r\n      this.wishText = event.target.value;\r\n      this.paint();\r\n    },\r\n    paint(avatarFilePath, happinessFilePath) {\r\n      if (!avatarFilePath) {\r\n        avatarFilePath = this.avatarPath;\r\n      }\r\n      if (!happinessFilePath) {\r\n        happinessFilePath = this.happinessPath;\r\n      }\r\n      this.drawCansBgImg(avatarFilePath);\r\n      this.drawCornerBg();\r\n      // this.drawHappiness(happinessFilePath);\r\n      this.drawDefaultText();\r\n      uni.vibrateShort({\r\n        success: function() {\r\n          console.log('vibrateShort');\r\n        }\r\n      });\r\n    },\r\n    drawCansBgImg(imageFilePath) {\r\n      this.ctx.drawImage(imageFilePath, 0, 0, this.cansWidth, this.cansHeight);\r\n      this.ctx.draw(false);\r\n    },\r\n    drawCornerBg() {\r\n      this._drawCircleWithBoarder(this.cornerBgBoarderColor, this.cornerBgColor, this.cornerX, this.cornerY, this.r, this\r\n          .boarderWidth);\r\n    },\r\n    drawHappiness(happinessFilePath) {\r\n      this.ctx.drawImage(happinessFilePath, this.cornerX + 5, this.cornerY + 7, this.cansWidth * 0.25, this.cansHeight *\r\n          0.25);\r\n      this.ctx.draw(true);\r\n    },\r\n    /**\r\n     * legacy\r\n     */\r\n    drawDefaultText() {\r\n      let textOption = {\r\n        text: this.wishText,\r\n        sLeft: 0.73,\r\n        sTop: 0.93,\r\n        fontSize: 60,\r\n        color: 'white',\r\n        bold: true,\r\n        lineHeight: 12\r\n      };\r\n      this._drawText(textOption);\r\n      uni.vibrateShort({\r\n        success: function() {\r\n          console.log('vibrateShort');\r\n        }\r\n      });\r\n    },\r\n    /**\r\n     *  绘制圆形边框\r\n     * @param {Object} sColor  线条色\r\n     * @param {Object} fColor\r\n     * @param {Object} cornerX  相对比例坐标\r\n     * @param {Object} cornerY\r\n     * @param {Object} r\r\n     */\r\n    _drawCircleWithBoarder(sColor, fColor, cornerX, cornerY, r, boarderWidth) {\r\n      this.ctx.save();\r\n      var cx = cornerX + r;\r\n      var cy = cornerY + r;\r\n      // 圆的中心的 cx, cy 坐标, 圆的半径, 起始角, 结束角。\r\n      this.ctx.arc(cx, cy, r, 0, 2 * Math.PI); // 创建弧/曲线（用于创建圆或部分圆）\r\n      this.ctx.setLineWidth(boarderWidth);\r\n      this.ctx.setStrokeStyle(sColor);\r\n      this.ctx.stroke();\r\n      this.ctx.setFillStyle(fColor);\r\n      this.ctx.fill();\r\n      this.ctx.restore();\r\n      this.ctx.draw(true);\r\n    },\r\n    _drawText(item) {\r\n      var isLeft\r\n      if (item.sLeft == 'center') {\r\n        isLeft = this.cansWidth * .5 - (item.fontSize * item.text.length) / 2\r\n      } else {\r\n        isLeft = item.sLeft * this.cansWidth\r\n      }\r\n      this.ctx.save()\r\n      if (item.bold) this.ctx.font = `normal bold ${item.fontSize}px edu-lishu`;\r\n      // if (item.bold) this.ctx.font = `normal bold ${item.fontSize}px ` + item.fontFamily;\r\n      // fontFamily\r\n      this.ctx.setFillStyle(item.color)\r\n      this.ctx.setFontSize(item.fontSize)\r\n      // this.ctx.setFontFamily(item.fontFamily);\r\n      if (item.text instanceof Array) {\r\n        if (!item.lineHeight) item.lineHeight = item.fontSize + 2\r\n        console.log('我是数组', item.text)\r\n        for (var i = 0; i < item.text.length; i++) {\r\n          this.ctx.fillText(item.text[i], isLeft, item.sTop * this.cansHeight + item.lineHeight * i)\r\n        }\r\n      } else {\r\n        console.log('绘制字符', item.text)\r\n        this.ctx.fillText(item.text, isLeft, item.sTop * this.cansHeight)\r\n      }\r\n      this.ctx.draw(true)\r\n      this.ctx.restore()\r\n    },\r\n    downloadAvatarAndPaintAll(imageUrl) {\r\n      uni.showLoading({\r\n        title: '加载中...'\r\n      });\r\n      let that = this;\r\n      uni.downloadFile({\r\n        url: imageUrl,\r\n        success: function(res) {\r\n          uni.hideLoading();\r\n          that.avatarPath = res.tempFilePath;\r\n          getApp().globalData.userAvatarFilePath = res.tempFilePath;\r\n          that.paint();\r\n        },\r\n        fail: function(e) {\r\n          console.log(e);\r\n          uni.hideLoading();\r\n          uni.showModal({\r\n            title: '图片加载超时',\r\n            content: '检查网络，点击确定重新加载',\r\n            success(res) {\r\n              if (res.confirm) {\r\n                that.downloadAvatarAndPaintAll(imageUrl);\r\n              } else if (res.cancel) {\r\n                console.log('用户点击取消');\r\n              }\r\n            }\r\n          })\r\n        }\r\n      })\r\n    },\r\n    /**\r\n     *  获取用户信息回调方法\r\n     */\r\n    getUserInfo(e) {\r\n      uni.getUserProfile({\r\n        desc: '用于完善个人资料', // 声明获取用户个人信息后的用途，后续会展示在弹窗中，请谨慎填写\r\n        success: (res) => {\r\n          this.$loading('拼命加载中...')\r\n          if (res.userInfo) {\r\n            this.ownImageUsed = true;\r\n            let userInfo = res.userInfo\r\n            userInfo.avatarUrl = userInfo.avatarUrl.replace(\"132\", \"0\"); // 使用最大分辨率头像 959 * 959\r\n            getApp().globalData.userAvatarUrl = userInfo.avatarUrl;\r\n            this.downloadAvatarAndPaintAll(userInfo.avatarUrl);\r\n            this.saveLoginUserInfo(userInfo);\r\n          } else {\r\n            uni.showModal({\r\n              title: '获取用户头像失败',\r\n              content: '用户信息仅用于创建新的图片，请放心使用',\r\n              showCancel: false\r\n            })\r\n          }\r\n        },\r\n      })\r\n    },\r\n    /**\r\n     *  选择图片\r\n     */\r\n    chooseImage() {\r\n      let that = this;\r\n      uni.chooseImage({\r\n        count: 1, // 默认9\r\n        sizeType: ['compressed'], //可以指定是原图还是压缩图，默认二者都有\r\n        sourceType: ['album', 'camera'],\r\n        success: function(res) {\r\n          console.log(res);\r\n          let tempImagePath = res.tempFilePaths[0];\r\n          that.imageCheck(tempImagePath, that.loadRecImageOrStartToCrop);\r\n          // that.loadRecImageOrStartToCrop(tempImagePath);\r\n        }\r\n      });\r\n    },\r\n    loadRecImageOrStartToCrop(tempImagePath) {\r\n      this.ownImageUsed = true;\r\n      let that = this;\r\n      uni.getImageInfo({\r\n        src: tempImagePath,\r\n        success: function(image) {\r\n          let width = image.width;\r\n          let height = image.height;\r\n          let delta = (width - height) / width.toFixed(3);\r\n          console.log('delta', delta);\r\n          // 如果是正方形或者接近正放心则直接加载不进行剪裁\r\n          if ((-0.02 <= delta && delta <= 0) || (0 < delta && delta <= 0.02)) {\r\n            let tempFilePathCompressed = tempImagePath;\r\n            that.avatarPath = tempImagePath;\r\n            that.paint();\r\n          } else {\r\n            uni.navigateTo({\r\n              url: '/pages/crop/crop?tempFilePath=' + tempImagePath\r\n            })\r\n          }\r\n        }\r\n      });\r\n    },\r\n    checkAdBeforeSave() {\r\n      let that = this;\r\n      if (!!videoAd && this.enableRewardedVideoAd && this.rewardedVideoAdLoaded &&\r\n          !this.rewardedVideoAdAlreadyShow && this.savedCounts >= this.freeCount) {\r\n        uni.showModal({\r\n          title: '获取无限使用次数',\r\n          content: '请完整观看趣味广告视频',\r\n          success: function(res) {\r\n            if (res.confirm) {\r\n              console.log('用户点击确定');\r\n              // 用户触发广告后，显示激励视频广告\r\n              if (videoAd) {\r\n                videoAd.show().catch(() => {\r\n                  // 失败重试\r\n                  videoAd.load()\r\n                      .then(() => {\r\n                        videoAd.show();\r\n                      })\r\n                      .catch(err => {\r\n                        console.log(err);\r\n                        console.log('激励视频 广告显示失败')\r\n                      })\r\n                })\r\n              }\r\n            } else if (res.cancel) {\r\n              console.log('用户点击取消');\r\n              // that.saveCans();\r\n              return;\r\n            }\r\n          }\r\n        });\r\n      } else {\r\n        this.saveCans();\r\n      }\r\n    },\r\n    /**\r\n     * 保存\r\n     */\r\n    saveCans() {\r\n      console.log('保存...')\r\n      let that = this;\r\n      uni.showLoading({\r\n        title: '保存...',\r\n        mask: true\r\n      })\r\n      uni.canvasToTempFilePath({\r\n        x: 0,\r\n        y: 0,\r\n        width: this.cansWidth * 1.5,\r\n        height: this.cansHeight * 1.5,\r\n        destWidth: this.cansWidth * 3,\r\n        destHeight: this.cansHeight * 3,\r\n        canvasId: 'cans-id-happines',\r\n        success: function(res) {\r\n          uni.hideLoading()\r\n          uni.saveImageToPhotosAlbum({\r\n            filePath: res.tempFilePath,\r\n            success: function(res) {\r\n              uni.showToast({\r\n                title: '请至相册查看'\r\n              })\r\n              uni.vibrateShort({\r\n                success: function() {\r\n                  console.log('vibrateShort');\r\n                }\r\n              });\r\n              that.savedCounts++;\r\n              // 保存时，如果没有激励广告则展示一次插屏广告，因为一个完整操作流程已结束，提升广告曝光\r\n              if (interstitialAd && that.enableInterstitialAd && !that.interstitialAdAlreadyShow &&\r\n                  !that.rewardedVideoAdAlreadyShow) { // 没有激励广告才在保存时展示插屏广告\r\n                interstitialAd.show()\r\n                    .then(() => {\r\n                      that.interstitialAdAlreadyShow = true;\r\n                    })\r\n                    .catch((err) => {\r\n                      interstitialAd.load().then(() => {\r\n                        interstitialAd.show();\r\n                      }).catch(err => {\r\n                        console.log(err);\r\n                        console.log('插屏广告显示失败')\r\n                      })\r\n                      console.error(err)\r\n                    })\r\n              }\r\n              console.log('保存成功')\r\n            },\r\n            fail(res) {\r\n              console.log(res)\r\n              if (res.errMsg.indexOf(\"fail\")) {\r\n                uni.showModal({\r\n                  title: '您需要授权相册权限',\r\n                  success(res) {\r\n                    if (res.confirm) {\r\n                      uni.openSetting({\r\n                        success(res) {\r\n                          console.log(\"相册授权成功\");\r\n                        },\r\n                        fail(res) {\r\n                          console.log(res)\r\n                        }\r\n                      })\r\n                    }\r\n                  }\r\n                })\r\n              }\r\n            }\r\n          });\r\n        },\r\n        fail(res) {\r\n          uni.hideLoading()\r\n        }\r\n      }, this)\r\n    },\r\n    imageCheck: function(tempImagePath, callback) {\r\n      if (!getApp().globalData.enableSecurityCheck) {\r\n        callback(tempImagePath);\r\n        return;\r\n      }\r\n      let that = this;\r\n      uni.compressImage({\r\n        src: tempImagePath,\r\n        quality: 1,\r\n        success: res => {\r\n          let tempFilePathCompressed = res.tempFilePath;\r\n          // console.log(res.tempFilePath)\r\n          wx.getFileSystemManager().readFile({\r\n            filePath: tempFilePathCompressed, // 压缩图片，然后安全检测\r\n            success: buffer => {\r\n              console.log(buffer.data);\r\n              uni.showLoading({\r\n                title: '加载中...'\r\n              });\r\n              //这里是 云函数调用方法\r\n              wx.cloud.callFunction({\r\n                name: 'contentCheck',\r\n                data: {\r\n                  value: buffer.data\r\n                },\r\n                success(json) {\r\n                  console.log(\"checkContent result\", json)\r\n                  if (json.result.errCode == 87014) {\r\n                    uni.showModal({\r\n                      title: '请勿使用违法违规内容',\r\n                      content: '图片含有违法违规内容',\r\n                      showCancel: false,\r\n                      confirmText: '知道了',\r\n                    });\r\n                    console.log(\"bad\")\r\n                  } else {\r\n                    console.log(\"good\")\r\n                    //图片合规则进行进一步处理\r\n                    callback(tempImagePath);\r\n                  }\r\n                },\r\n                fail(e) {\r\n                  console.log(e);\r\n                  uni.showModal({\r\n                    title: '请重试',\r\n                    content: '对不起，服务器开了小差',\r\n                    showCancel: false,\r\n                    confirmText: '好的',\r\n                  });\r\n                },\r\n                complete() {\r\n                  uni.hideLoading();\r\n                }\r\n              })\r\n            }\r\n          })\r\n        }\r\n      })\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.isCan {\r\n  border: 6px solid white;\r\n  border-radius: 10px;\r\n  width: 270px;\r\n  height: 270px;\r\n  margin-top: 150rpx;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  background-size: 100%;\r\n  z-index: 800;\r\n}\r\n\r\n@media (min-width: 320px) {\r\n  /* 仅在 320px 或更宽的屏幕上生效的样式规则 */\r\n  .action-wrapper {\r\n    padding-top: 50rpx;\r\n    padding-left: 100rpx;\r\n    padding-right: 100rpx;\r\n    font-weight: 800;\r\n  }\r\n\r\n  // .action-btn {\r\n  // \tbackground-color: #FFC700;\r\n  // \tcolor: white;\r\n  // }\r\n}\r\n\r\n.action-wrapper {\r\n  padding-top: 50rpx;\r\n  padding-left: 100rpx;\r\n  padding-right: 100rpx;\r\n  font-weight: 800;\r\n}\r\n\r\n// .action-btn {\r\n// \tbackground-color: #FFC700;\r\n// \tcolor: white;\r\n// }\r\n\r\n.share-wrapper {\r\n  padding-top: 50rpx;\r\n  padding-left: 100rpx;\r\n  padding-right: 100rpx;\r\n  font-weight: 800;\r\n}\r\n\r\n.happiness-option-wrapper {\r\n  position: absolute;\r\n  z-index: 1000;\r\n  width: 200rpx;\r\n  margin-top: 25px;\r\n}\r\n\r\n.happiness-option {\r\n  width: 60px;\r\n  height: 60px;\r\n}\r\n</style>\r\n","import mod from \"-!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add-text.vue?vue&type=style&index=0&id=0a283052&lang=scss&scoped=true&\"; export default mod; export * from \"-!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\wamp\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add-text.vue?vue&type=style&index=0&id=0a283052&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1622719021516\n      var cssReload = require(\"D:/wamp/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}